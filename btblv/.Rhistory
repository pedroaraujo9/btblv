y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = Inf, a = 10, b = 10, c = 0.5)
integrate(f = f, lower = 0, upper = Inf, a = 10, b = 10, c = c)
integrate(f = f, lower = 0, upper = Inf, a = 10, b = 10, c = c)
integrate(f = f, lower = 0, upper = 1/(1-c), a = 10, b = 10, c = c)
c = 0.1
1/(1-c)
x = seq(0.0001, 1/(1-c), 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/(1-c), a = 10, b = 10, c = c)
a = 10
b = 10
c = 0.1
1/(1-c)
x = seq(0.0001, 1/(1-c), 0.001)
x = seq(0, 1/(1-c), 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
c = 0.5
1/(1-c)
x = seq(0, 1/(1-c), 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/(1-c), a = 10, b = 10, c = c)
c = 0.7
1/(1-c)
x = seq(0, 1/(1-c), 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/(1-c), a = 10, b = 10, c = c)
a = 10
b = 10
c = 0.7
1/(1-c)
x = seq(0, 2, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
a = 10
b = 10
c = 0.7
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 10
b = 10
c = 0.1
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 10
b = 10
c = 0.001
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 10
b = 20
c = 0.7
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 10
b = 30
c = 0.7
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 10
b = 30
c = 0.9
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
n = 1000
x = rgamma(n, a)
y = rgamma(n, b)
yr = x / (c*x + y)
hist(yr)
n = 100000
x = rgamma(n, a)
y = rgamma(n, b)
yr = x / (c*x + y)
hist(yr)
lines(x = x, y=y)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
lines(x = x, y=y)
hist(yr, probability = T)
lines(x = x, y=y)
a = 10
b = 30
c = 0.1
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
n = 100000
x = rgamma(n, a)
z = rgamma(n, b)
yr = x / (c*x + z)
hist(yr, probability = T)
lines(x = x, y=y)
a = 10
b = 30
c = 0.1
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
n = 100000
x1 = rgamma(n, a)
x2 = rgamma(n, b)
yr = x1 / (c*x1 + x2)
hist(yr, probability = T)
lines(x = x, y=y)
a = 10
b = 50
c = 0.1
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
n = 100000
x1 = rgamma(n, a)
x2 = rgamma(n, b)
yr = x1 / (c*x1 + x2)
hist(yr, probability = T)
lines(x = x, y=y)
mean(yr)
a/(c*a+b)
1/0.1
1/0.2
1/0.3
1/0.5
1/0.99
1/0.98
1/0.999
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
integrate(f = f, lower = 0, upper = 1, a = 10, b = 10, c = c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1, a = 10, b = 10, c = c)
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 11
b = 50
c = 0.1
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 11
b = 50
c = 0.2
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
a = 11
b = 50
c = 0.99
1/(c)
x = seq(0, 1/c, 0.001)
y = f(x, a = a, b = b, c = c)
plot(x, y, type="l")
integrate(f = f, lower = 0, upper = 1/c, a = 10, b = 10, c = c)
n = 100000
x1 = rgamma(n, a)
x2 = rgamma(n, b)
yr = x1 / (c*x1 + x2)
hist(yr, probability = T)
lines(x = x, y=y)
mean(yr)
devtools::load_all()
example_fit$single_K1$btblv_data$data %>%
glimpse()
plot_corrmatrix = function(btblv_data) {
btblv_data$data %>%
select(group, time, item, y) %>%
spread(item, y) %>%
select(-group, -time) %>%
as.matrix() %>%
logit() %>%
cor() %>%
as.data.frame() %>%
as_tibble() %>%
mutate(item1 = colnames(.)) %>%
gather(item2, value, -item1) %>%
mutate(value = as.numeric(value),
age1 = factor(item1, levels = btblv_data$data$item %>% unique()),
age2 = factor(item2, levels = btblv_data$data$item %>% unique())) %>%
ggplot(aes(x=item1, y=item2, fill=value)) +
geom_tile(color="white") +
viridis::scale_fill_viridis() +
guides(color = "none") +
scale_color_manual(values = c("black", "white")) +
labs(x="", y="", fill="Corr")
}
plot_corrmatrix(example_fit$single_K1$btblv_data)
library(tidyverse)
plot_corrmatrix(example_fit$single_K1$btblv_data)
plot_corrmatrix = function(btblv_data) {
btblv_data$data %>%
select(group, time, item, y) %>%
spread(item, y) %>%
select(-group, -time) %>%
as.matrix() %>%
logit() %>%
cor() %>%
as.data.frame() %>%
as_tibble() %>%
mutate(item1 = colnames(.)) %>%
gather(item2, value, -item1) %>%
mutate(value = as.numeric(value),
age1 = factor(item1, levels = btblv_data$data$item %>% unique() %>% sort()),
age2 = factor(item2, levels = btblv_data$data$item %>% unique() %>% sort())) %>%
ggplot(aes(x=item1, y=item2, fill=value)) +
geom_tile(color="white") +
viridis::scale_fill_viridis() +
guides(color = "none") +
scale_color_manual(values = c("black", "white")) +
labs(x="", y="", fill="Corr")
}
plot_corrmatrix(example_fit$single_K1$btblv_data)
plot_corrmatrix = function(btblv_data) {
btblv_data$data %>%
select(group, time, item, y) %>%
spread(item, y) %>%
select(-group, -time) %>%
as.matrix() %>%
logit() %>%
cor() %>%
as.data.frame() %>%
as_tibble() %>%
mutate(item1 = colnames(.)) %>%
gather(item2, value, -item1) %>%
mutate(value = as.numeric(value),
age1 = factor(item1, levels = btblv_data$data$item %>% unique() %>% sort()),
age2 = factor(item2, levels = btblv_data$data$item %>% unique() %>% sort())) %>%
ggplot(aes(x=item1, y=item2, fill=value)) +
geom_tile(color="white") +
viridis::scale_fill_viridis() +
guides(color = "none") +
scale_color_manual(values = c("black", "white")) +
labs(x="", y="", fill="Corr")
}
btblv_data = create_btblv_data(
example_fit$single_K1$btblv_data$df,
"mx", "age", "country", "year"
)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year")
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_corrmatrix()
example_fit$single_K1$btblv_data$data$item %>% unique()
plot_corrmatrix = function(btblv_data) {
levels = btblv_data$data$item %>% unique()
btblv_data$data %>%
select(group, time, item, y) %>%
spread(item, y) %>%
select(-group, -time) %>%
as.matrix() %>%
logit() %>%
cor() %>%
as.data.frame() %>%
as_tibble() %>%
mutate(item1 = colnames(.)) %>%
gather(item2, value, -item1) %>%
mutate(value = as.numeric(value),
item1 = factor(item1, levels = btblv_data$data$item %>% unique()),
item2 = factor(item2, levels = btblv_data$data$item %>% unique())) %>%
ggplot(aes(x=item1, y=item2, fill=value)) +
geom_tile(color="white") +
viridis::scale_fill_viridis() +
guides(color = "none") +
scale_color_manual(values = c("black", "white")) +
labs(x="", y="", fill="Corr")
}
plot_corrmatrix(example_fit$single_K1$btblv_data)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_corrmatrix()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("qx", "age", "country", "year") %>%
plot_corrmatrix()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("qx", "age", "country", "year") %>%
plot_corrmatrix()
plot_corrmatrix = function(btblv_data) {
levels = btblv_data$data$item %>% unique()
corrplot = btblv_data$data %>%
dplyr::select(group, time, item, y) %>%
tidyr::spread(item, y) %>%
dplyr::select(-group, -time) %>%
base::as.matrix() %>%
btblv::logit() %>%
stats::cor() %>%
base::as.data.frame() %>%
tibble::as_tibble() %>%
dplyr::mutate(item1 = colnames(.)) %>%
tidyr::gather(item2, value, -item1) %>%
dplyr::mutate(value = as.numeric(value),
item1 = factor(item1, levels = btblv_data$data$item %>% unique()),
item2 = factor(item2, levels = btblv_data$data$item %>% unique())) %>%
ggplot2::ggplot(aes(x=item1, y=item2, fill=value)) +
ggplot2::geom_tile(color="white") +
viridis::scale_fill_viridis() +
ggplot2::guides(color = "none") +
ggplot2::scale_color_manual(values = c("black", "white")) +
ggplot2::labs(x="", y="", fill="Corr")
return(corrplot)
}
#' Plot correlation matrix for the dataset
#'
#' @param btblv_data
#' @param transform function with data transformation. Default is `btblv::logit`.
#'
#' @return `ggplot2` plot with the correlation matrix.
#' @export
#'
#' @examples
#' example_fit$single_K2$btblv_data %>% plot_corrmatrix()
plot_corrmatrix = function(btblv_data, transform = btblv::logit) {
levels = btblv_data$data$item %>% unique()
if(is.null(transform)) {
corrplot = btblv_data$data %>%
dplyr::select(group, time, item, y) %>%
tidyr::spread(item, y) %>%
dplyr::select(-group, -time) %>%
base::as.matrix() %>%
transform() %>%
stats::cor() %>%
base::as.data.frame() %>%
tibble::as_tibble() %>%
dplyr::mutate(item1 = colnames(.)) %>%
tidyr::gather(item2, value, -item1) %>%
dplyr::mutate(value = as.numeric(value),
item1 = factor(item1, levels = btblv_data$data$item %>% unique()),
item2 = factor(item2, levels = btblv_data$data$item %>% unique())) %>%
ggplot2::ggplot(aes(x=item1, y=item2, fill=value)) +
ggplot2::geom_tile(color="white") +
viridis::scale_fill_viridis() +
ggplot2::guides(color = "none") +
ggplot2::scale_color_manual(values = c("black", "white")) +
ggplot2::labs(x="", y="", fill="Corr")
}else{
corrplot = btblv_data$data %>%
dplyr::select(group, time, item, y) %>%
tidyr::spread(item, y) %>%
dplyr::select(-group, -time) %>%
base::as.matrix() %>%
btblv::logit() %>%
stats::cor() %>%
base::as.data.frame() %>%
tibble::as_tibble() %>%
dplyr::mutate(item1 = colnames(.)) %>%
tidyr::gather(item2, value, -item1) %>%
dplyr::mutate(value = as.numeric(value),
item1 = factor(item1, levels = btblv_data$data$item %>% unique()),
item2 = factor(item2, levels = btblv_data$data$item %>% unique())) %>%
ggplot2::ggplot(aes(x=item1, y=item2, fill=value)) +
ggplot2::geom_tile(color="white") +
viridis::scale_fill_viridis() +
ggplot2::guides(color = "none") +
ggplot2::scale_color_manual(values = c("black", "white")) +
ggplot2::labs(x="", y="", fill="Corr")
}
return(corrplot)
}
devtools::load_all()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("qx", "age", "country", "year") %>%
plot_corrmatrix()
devtools::load_all()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("qx", "age", "country", "year") %>%
plot_corrmatrix()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_corrmatrix()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_corrmatrix(transform = NULL)
usethis::use_test("plot_corrmatrix")
devtools::test(filter = "plot_corrmatrix")
usethis::use_test("plot_corrmatrix")
devtools::load_all()
usethis::use_test("plot_corrmatrix")
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("qx", "age", "country", "year") %>%
plot_corrmatrix() %>%
expect_no_error()
devtools::test(filter = "plot_corrmatrix")
?create_btblv_data
usethis::use_package("EnvStats")
#' Plot Kendall's trend coefficient
#'
#' @param btblv_data `btblv_data` object create with `btblv::create_btblv_data`
#' @param transform function with data transformation. Default is `btblv::logit`.
#' If you do not want transformations use `NULL`.
#'
#' @return `ggplot2` plot with the correlation matrix.
#' @export
#'
#' @import dplyr
#' @import tidyr
#' @import ggplot2
#'
#' @examples
#' example_fit$single_K2$btblv_data %>% plot_trend()
#'
plot_trend = function(btblv_data, transform = btblv::logit) {
if(is.null(transform)) {
tau_over_time = btblv_data$data %>%
dplyr::select(group, item, time, y) %>%
dplyr::arrange(group, time, item) %>%
dplyr::group_by(group, item) %>%
dplyr::summarise(tau = .get_tau(y))
}else{
tau_over_time = btblv_data$data %>%
dplyr::select(group, item, time, y) %>%
dplyr::arrange(group, time, item) %>%
dplyr::group_by(group, item) %>%
dplyr::summarise(tau = .get_tau(transform(y)))
}
pl = tau_over_time %>%
ggplot2::ggplot(ggplot2::aes(x=factor(item), y=group, fill=tau)) +
ggplot2::geom_tile(color="white") +
ggplot2::scale_fill_viridis() +
ggplot2::labs(fill=expression(tau))
return(pl)
}
devtools::load_all()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = NULL)
devtools::test(filter = "plot_corrmatrix")
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_corrmatrix(transform = NULL)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = NULL)
devtools::load_all()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = NULL)
devtools::load_all()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_corrmatrix(transform = NULL)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = NULL)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend()
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = "log")
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = log)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = log)
example_fit$single_K1$btblv_data$df %>%
create_btblv_data("mx", "age", "country", "year") %>%
plot_trend(transform = NULL)
usethis::use_test("plot_trend")
is
is(example_fit$single_K1, "btblv")
is(example_fit$single_K1, "btblv_data")
is(example_fit$single_K1$btblv_data, "btblv_data")
devtools::load_all()
devtools::test(filter = "plot_trend")
class(btblv::logit)
is(btblv::logit, "function")
is(log, "function")
devtools::document()
devtools::test()
devtools::test()
devtools::check()
usethis::use_package("ggplot2")
usethis::use_package("viridis")
devtools::check()
devtools::check()
usethis::use_package("latex2exp")
devtools::check()
